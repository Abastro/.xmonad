#!/bin/sh
cfgid="pulpmonad"
barid="pulpbar"
output="$1"
cache="$( dirname "$1" )"

# TODO this build shell also needs rework, as it only checks `app` directory

echo "[Build] Begin"
if ! cabal build "exe:$cfgid" "exe:$barid" | grep "Up to date" ; then
  cabal install "exe:$cfgid" "exe:$barid" \
    --installdir="$cache" --install-method=copy \
    --overwrite-policy=always
  ln -sf "$cache/$cfgid" "$output"
  # To make next Up-To-Date build faster
  cabal build "exe:$cfgid" "exe:$barid"
fi
echo "[Build] End"
