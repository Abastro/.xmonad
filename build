#!/bin/sh
output="$1"
cfgid="xmonad-abcfg"
apps="./app"
cfgs="./cfg"

lastModified () {
    stat -c '%Y' $1
}
lastModifiedIn () {
    find $1 -type f -exec stat -c '%Y' "{}" \; | sort -n | tail -1
}

appMod=$( lastModifiedIn $apps )
cfgMod=$( lastModifiedIn $cfgs )
echo "$appMod, $cfgMod, $( lastModified $1 )"
if [ ! -f $1 ] || [ $(($appMod > $cfgMod? $appMod : $cfgMod)) -gt $( lastModified $1 ) ] ; then
    cabal build "$cfgid"
    cabal install "$cfgid" \
        --enable-executable-stripping \
        --enable-optimization=2 \
        --installdir="./bin/" --install-method=copy \
        --overwrite-policy=always
    ln -sf "./bin/$cfgid" "$1"
fi
